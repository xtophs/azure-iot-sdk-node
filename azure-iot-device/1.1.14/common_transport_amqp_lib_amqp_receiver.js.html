<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: common/transport/amqp/lib/amqp_receiver.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">
    <h1 class="page-title">Source: common/transport/amqp/lib/amqp_receiver.js</h1>
    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// Copyright (c) Microsoft. All rights reserved.
// Licensed under the MIT license. See LICENSE file in the project root for full license information.
'use strict';
var __extends = (this &amp;&amp; this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array &amp;&amp; function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
var events_1 = require("events");
var amqp_message_js_1 = require("./amqp_message.js");
var azure_iot_common_1 = require("azure-iot-common");
/**
 * @class            module:azure-iot-amqp-base.AmqpReceiver
 * @classdesc        The `AmqpReceiver` class is used to receive and settle messages.
 *
 * @param {Object}   amqpReceiver   The Receiver object that is created by the client using the `node-amqp10` library.
 *
 * @fires module:azure-iot-amqp-base.AmqpReceiver#message
 * @fires module:azure-iot-amqp-base.AmqpReceiver#errorReceived
 */
/* Codes_SRS_NODE_IOTHUB_AMQPRECEIVER_16_001: [The AmqpReceiver method shall create a new instance of AmqpReceiver.]*/
/* Codes_SRS_NODE_IOTHUB_AMQPRECEIVER_16_002: [The created AmqpReceiver object shall emit a ‘message’ event when a message is received.]*/
/* Codes_SRS_NODE_IOTHUB_AMQPRECEIVER_16_003: [The created AmqpReceiver object shall emit a ‘errorReceived’ event when an error is received.]*/
/* Codes_SRS_NODE_IOTHUB_AMQPRECEIVER_16_004: [If the receiver object passed as an argument is falsy, the AmqpReceiver should throw an ReferenceError]*/
var AmqpReceiver = (function (_super) {
    __extends(AmqpReceiver, _super);
    function AmqpReceiver(amqpReceiver) {
        var _this = this;
        if (!amqpReceiver) {
            throw new ReferenceError('amqpReceiver');
        }
        _this = _super.call(this) || this;
        _this._amqpReceiver = amqpReceiver;
        _this._listenersInitialized = false;
        var self = _this;
        _this.on('removeListener', function () {
            // stop listening for AMQP events if our consumers stop listening for our events
            if (self._listenersInitialized &amp;&amp; self.listeners('message').length === 0) {
                self._removeAmqpReceiverListeners();
            }
        });
        _this.on('newListener', function () {
            // lazy-init AMQP event listeners
            if (!self._listenersInitialized) {
                self._setupAmqpReceiverListeners();
            }
        });
        return _this;
    }
    /**
     * @method          module:azure-iot-amqp-base.AmqpReceiver#complete
     * @description     Sends a completion feedback message to the service.
     * @param {AmqpMessage}   message  The message that is being settled.
     */
    /* Codes_SRS_NODE_IOTHUB_AMQPRECEIVER_16_006: [If the message object passed as an argument is falsy, a ReferenceError should be thrown]*/
    AmqpReceiver.prototype.complete = function (message, done) {
        if (!message) {
            throw new ReferenceError('Invalid message object.');
        }
        this._amqpReceiver.accept(message.transportObj);
        if (done)
            done(null, new azure_iot_common_1.results.MessageCompleted());
    };
    /**
     * @method          module:azure-iot-amqp-base.AmqpReceiver#abandon
     * @description     Sends an abandon/release feedback message
     * @param {AmqpMessage}   message  The message that is being settled.
     */
    /* Codes_SRS_NODE_IOTHUB_AMQPRECEIVER_16_008: [If the message object passed as an argument is falsy, a ReferenceError should be thrown]*/
    AmqpReceiver.prototype.abandon = function (message, done) {
        if (!message) {
            throw new ReferenceError('Invalid message object.');
        }
        this._amqpReceiver.release(message.transportObj);
        if (done)
            done(null, new azure_iot_common_1.results.MessageAbandoned());
    };
    /**
     * @method          module:azure-iot-amqp-base.AmqpReceiver#reject
     * @description     Sends an reject feedback message
     * @param {AmqpMessage}   message  The message that is being settled.
     */
    /* Codes_SRS_NODE_IOTHUB_AMQPRECEIVER_16_010: [If the message object passed as an argument is falsy, a ReferenceError should be thrown]*/
    AmqpReceiver.prototype.reject = function (message, done) {
        if (!message) {
            throw new ReferenceError('Invalid message object.');
        }
        this._amqpReceiver.reject(message.transportObj);
        if (done)
            done(null, new azure_iot_common_1.results.MessageRejected());
    };
    AmqpReceiver.prototype._onAmqpErrorReceived = function (err) {
        /**
         * @event module:azure-iot-amqp-base.AmqpReceiver#errorReceived
         * @type {Error}
         */
        this.emit('errorReceived', err);
    };
    AmqpReceiver.prototype._onAmqpMessage = function (amqpMessage) {
        /**
         * @event module:azure-iot-amqp-base.AmqpReceiver#message
         * @type {Message}
         */
        var msg = amqp_message_js_1.AmqpMessage.toMessage(amqpMessage);
        this.emit('message', msg);
    };
    AmqpReceiver.prototype._setupAmqpReceiverListeners = function () {
        this._listeners = [
            { eventName: 'errorReceived', listener: this._onAmqpErrorReceived.bind(this) },
            { eventName: 'message', listener: this._onAmqpMessage.bind(this) }
        ];
        for (var i = 0; i &lt; this._listeners.length; ++i) {
            var listener = this._listeners[i];
            this._amqpReceiver.on(listener.eventName, listener.listener);
        }
        this._listenersInitialized = true;
    };
    AmqpReceiver.prototype._removeAmqpReceiverListeners = function () {
        if (this._listenersInitialized === true) {
            for (var i = 0; i &lt; this._listeners.length; ++i) {
                var listener = this._listeners[i];
                this._amqpReceiver.removeListener(listener.eventName, listener.listener);
            }
            this._listenersInitialized = false;
        }
    };
    return AmqpReceiver;
}(events_1.EventEmitter));
exports.AmqpReceiver = AmqpReceiver;
//# sourceMappingURL=amqp_receiver.js.map</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-azure-iot-amqp-base.html">azure-iot-amqp-base</a></li><li><a href="module-azure-iot-common.html">azure-iot-common</a></li><li><a href="module-azure-iot-device.html">azure-iot-device</a></li><li><a href="module-azure-iot-device-amqp.html">azure-iot-device-amqp</a></li><li><a href="module-azure-iot-device-http.html">azure-iot-device-http</a></li><li><a href="module-azure-iot-device-mqtt.html">azure-iot-device-mqtt</a></li><li><a href="module-azure-iot-http-base.html">azure-iot-http-base</a></li></ul><h3>Classes</h3><ul><li><a href="module-azure-iot-amqp-base.Amqp.html">azure-iot-amqp-base.Amqp</a></li><li><a href="module-azure-iot-amqp-base.AmqpMessage.html">azure-iot-amqp-base.AmqpMessage</a></li><li><a href="module-azure-iot-amqp-base.AmqpReceiver.html">azure-iot-amqp-base.AmqpReceiver</a></li><li><a href="module-azure-iot-amqp-base.PutTokenOperation.html">azure-iot-amqp-base.PutTokenOperation</a></li><li><a href="module-azure-iot-amqp-base.PutTokenStatus.html">azure-iot-amqp-base.PutTokenStatus</a></li><li><a href="module-azure-iot-common.ArgumentError.html">azure-iot-common.ArgumentError</a></li><li><a href="module-azure-iot-common.ArgumentOutOfRangeError.html">azure-iot-common.ArgumentOutOfRangeError</a></li><li><a href="module-azure-iot-common.BadDeviceResponseError.html">azure-iot-common.BadDeviceResponseError</a></li><li><a href="module-azure-iot-common.DeviceAlreadyExistsError.html">azure-iot-common.DeviceAlreadyExistsError</a></li><li><a href="module-azure-iot-common.DeviceMaximumQueueDepthExceededError.html">azure-iot-common.DeviceMaximumQueueDepthExceededError</a></li><li><a href="module-azure-iot-common.DeviceMessageLockLostError.html">azure-iot-common.DeviceMessageLockLostError</a></li><li><a href="module-azure-iot-common.DeviceNotFoundError.html">azure-iot-common.DeviceNotFoundError</a></li><li><a href="module-azure-iot-common.DeviceTimeoutError.html">azure-iot-common.DeviceTimeoutError</a></li><li><a href="module-azure-iot-common.FormatError.html">azure-iot-common.FormatError</a></li><li><a href="module-azure-iot-common.GatewayTimeoutError.html">azure-iot-common.GatewayTimeoutError</a></li><li><a href="module-azure-iot-common.InvalidEtagError.html">azure-iot-common.InvalidEtagError</a></li><li><a href="module-azure-iot-common.InvalidOperationError.html">azure-iot-common.InvalidOperationError</a></li><li><a href="module-azure-iot-common.IoTHubSuspendedError.html">azure-iot-common.IoTHubSuspendedError</a></li><li><a href="module-azure-iot-common.Message.html">azure-iot-common.Message</a></li><li><a href="module-azure-iot-common.PreconditionFailedError.html">azure-iot-common.PreconditionFailedError</a></li><li><a href="module-azure-iot-common.SharedAccessSignature.html">azure-iot-common.SharedAccessSignature</a></li><li><a href="module-azure-iot-common.ThrottlingError.html">azure-iot-common.ThrottlingError</a></li><li><a href="module-azure-iot-common.TimeoutError.html">azure-iot-common.TimeoutError</a></li><li><a href="module-azure-iot-common.UnauthorizedError.html">azure-iot-common.UnauthorizedError</a></li><li><a href="module-azure-iot-device.Client.html">azure-iot-device.Client</a></li><li><a href="module-azure-iot-device-amqp.Amqp.html">azure-iot-device-amqp.Amqp</a></li><li><a href="module-azure-iot-device-amqp.AmqpWs.html">azure-iot-device-amqp.AmqpWs</a></li><li><a href="module-azure-iot-device-http.Http.html">azure-iot-device-http.Http</a></li><li><a href="module-azure-iot-device-http.HttpReceiver.html">azure-iot-device-http.HttpReceiver</a></li><li><a href="module-azure-iot-device-mqtt.Mqtt.html">azure-iot-device-mqtt.Mqtt</a></li><li><a href="module-azure-iot-http-base.Http.html">azure-iot-http-base.Http</a></li></ul><h3>Events</h3><ul><li><a href="module-azure-iot-amqp-base.AmqpReceiver.html#event:errorReceived">azure-iot-amqp-base.AmqpReceiver#errorReceived</a></li><li><a href="module-azure-iot-amqp-base.AmqpReceiver.html#event:message">azure-iot-amqp-base.AmqpReceiver#message</a></li><li><a href="module-azure-iot-device-http.HttpReceiver.html#event:errorReceived">azure-iot-device-http.HttpReceiver#errorReceived</a></li><li><a href="module-azure-iot-device-http.HttpReceiver.html#event:message">azure-iot-device-http.HttpReceiver#message</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Fri Jun 02 2017 15:14:42 GMT-0700 (Pacific Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
